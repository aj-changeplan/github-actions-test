name: Deployment

on:
  push:
    branches: [main, develop]

jobs:

  Test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: "14.x"

      - name: Setup Meteor.js environment
        uses: meteorengineer/setup-meteor@v1.0.8
      - run: meteor npm i
      - run: meteor npm test

  Deployment:
    runs-on: ubuntu-latest
    env:
      PRIVATE_KEY: ${{ secrets.KEY  }}
      HOSTNAME : ${{ secrets.HOST  }}
      USER_NAME : ${{ secrets.USERNAME  }}

    steps:
      - name: Set up SSH Key
        run: node --version
      - run: echo "$PRIVATE_KEY" > private_key && chmod 600 private_key
      - run: ssh -o StrictHostKeyChecking=no -i private_key ${USER_NAME}@${HOSTNAME} '

          cd /home/ubuntu &&
          touch tttt.txt

          '
